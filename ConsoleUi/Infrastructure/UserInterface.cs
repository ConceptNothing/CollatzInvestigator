using ConsoleUi.Core;
using SequenceCalculator.Core;
using System.Text.RegularExpressions;
using System.Diagnostics;
using System.Text;
using SequenceCalculator.Infrastructure;

namespace ConsoleUi.Infrastructure
{
    public class UserInterface : IUserInterface
    {
        private Stopwatch stopwatch;
        private bool isRunning = false;
        private readonly ICollatzInvestigator investigator;
        public UserInterface(ICollatzInvestigator investigator)
        {
            this.investigator= investigator;
            stopwatch= new Stopwatch();
        }
        public void Run()
        {
            isRunning=true;

            Console.BackgroundColor= ConsoleColor.DarkGray;
            Console.WriteLine("Welcome to my excellent and smart application!");
            Console.WriteLine("Collatz Conjecture \"Solver\"");
            Console.WriteLine("You might check UserInterface code, there are huge input examples commented for you <3");
            Console.BackgroundColor=ConsoleColor.Black;

            while (isRunning)
            {
                Console.BackgroundColor= ConsoleColor.DarkBlue;
                Console.WriteLine();
                Console.WriteLine("Enter n, or press 'Q' to quit:");
                Console.BackgroundColor = ConsoleColor.Black;
                Console.WriteLine();

                var input = Console.ReadLine();

                if (input != null)
                {
                    if(input.ToLower() == "q") 
                    {
                        isRunning = false;
                        continue;
                    }

                    if (Regex.IsMatch(input, @"^\d+$") && !input.StartsWith("0"))
                    {
                        stopwatch.Reset();

                        //This is 1500 digit number input. Execution time is approx 5 seconds
                        //input = "56725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666665672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625667527625";

                        //This is 3000 digit number input. Execution time is approx 30 seconds
                        //input = "5672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625";

                        //This is 12k digit number input. Execution time is approx 10 minutes, PLEASE HELP :(
                        //input = "567256276762376217656872459257685276127262667256276762376217656872459257685276127262672672615159747467695798127467296939979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656872459257685276127262672672615159747467695798127467296999798789787878751212461576527626453400000000004267436720346666666675276255672562767623762176568724592576852761272626726726151597474676957981274672969997987897878787512124615765276264534000000000042674367203466666666752762556725627676237621765687245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625567256276762376217656187245925768527612726267267261515974746769579812746729699979878978787875121246157652762645340000000000426743672034666666667527625";

                        PrintResult(input);
                    }
                    else
                    {
                        Console.BackgroundColor= ConsoleColor.Red;
                        Console.WriteLine("Invalid input: " + input);
                        Console.WriteLine("Input should contain only non-negative integers!");
                        Console.BackgroundColor= ConsoleColor.Black;
                        continue;
                    }
                }
                else
                {
                    Console.WriteLine("Empty input! Try again!");
                    continue;
                }
            }
        }

        private void PrintResult(string input)
        {
            stopwatch.Start();
            var result = investigator.ShowResult(input);
            Console.BackgroundColor = ConsoleColor.DarkGreen;
            Console.WriteLine(result);
            Console.BackgroundColor = ConsoleColor.Black;
            stopwatch.Stop();
            var elapsedTime = stopwatch.Elapsed;
            Console.WriteLine("Execution time: " + elapsedTime.ToString());
        }
    }
}
